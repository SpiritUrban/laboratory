<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./src/css/common.css" />
    <!--
       night-owl 
    atom-one-dark
    
    -->
  </head>
  <body>
    <h1 class="sound" onclick="speakText(this.innerHTML);">
      JavaScript String Methods
    </h1>

    <!-- ***************************************** Article ***************************************** -->
    <article>
      <p class="sound" onclick="speakText(this.innerHTML);">
        substring(). slice(). substr(). replace(). replaceAll(). toUpperCase().
        toLowerCase(). concat(). trim(). trimStart(). trimEnd(). padStart().
        padEnd(). charAt(). charCodeAt(). split().
      </p>

      <p class="sound" onclick="speakText(this.innerHTML);">
        There are 3 methods for extracting a part of a string:
      </p>

      <pre><code>
slice(start, end);
substring(start, end);
substr(start, length);
</code></pre>
    </article>

    <!-- ***************************************** Article ***************************************** -->
    <article>
      <h2 class="sound" onclick="speakText(this.innerHTML);">
        JavaScript String: slice()
      </h2>

      <p class="sound" onclick="speakText(this.innerHTML);">
        slice() extracts a part of a string and returns the extracted part in a
        new string.
      </p>

      <p class="sound" onclick="speakText(this.innerHTML);">
        The method takes 2 parameters: start position, and end position (end not
        included).
      </p>

      <pre><code>
let text = "Apple, Banana, Kiwi";
let part = text.slice(7, 13);
</code></pre>

      <p class="sound" onclick="speakText(this.innerHTML);">
        Slice out a portion of a string from position 7 to position 13:
      </p>

      <p class="sound" onclick="speakText(this.innerHTML);">
        If you omit the second parameter, the method will slice out the rest of
        the string:
      </p>

      <pre><code>
let text = "Apple, Banana, Kiwi";
let part = text.slice(7);
</code></pre>

      <p class="sound" onclick="speakText(this.innerHTML);">
        If a parameter is negative, the position is counted from the end of the
        string:
      </p>

      <pre><code>
let text = "Apple, Banana, Kiwi";
let part = text.slice(-12);
</code></pre>

      <p class="sound" onclick="speakText(this.innerHTML);">
        This example slices out a portion of a string from position -12 to
        position -6:
      </p>

      <pre><code>
let text = "Apple, Banana, Kiwi";
let part = text.slice(-12, -6);    
</code></pre>
    </article>

    <!-- ***************************************** Article ***************************************** -->
    <article id="article2">
      <h2 class="sound" onclick="speakText(this.innerHTML);">
        JavaScript String: substring()
      </h2>
      <script>
        const article = document.querySelector("#article2");

        // DATA START
        const data = [
          "substring() is similar to slice().",
          "The difference is that start and end values less than 0 are treated as 0 in substring().",
          `
>>code
let str = "Apple, Banana, Kiwi";
let part = str.substring(7, 13);
`,
          "He's purely positive!",
          "If you omit the second parameter, substring() will slice out the rest of the string.",
        ];
        // DATA END

        data.forEach((item) => {
          let template = `
            <p class="sound" onclick="speakText(this.innerHTML);"> ${item} </p>          
          `;
          if (item.slice(0, 7) == "\n>>code")
            template = `<pre><code>${item.slice(7)}</code></pre>          
          `;
          article.innerHTML += template;
        });
      </script>
    </article>

    <!-- ***************************************** Article ***************************************** -->
    <article id="article3">
      <script>
        const article3 = document.querySelector("#article3");

        // DATA START
        const data3 = [
          `
>>h JavaScript String: substr()
          `,
          "substr() is similar to slice().",
          "The difference is that the second parameter specifies the length of the extracted part.",
          `
>>code
let str = "Apple, Banana, Kiwi";
let part = str.substr(7, 6);
`,
          "If you omit the second parameter, substr() will slice out the rest of the string.",
          `
>>code
let str = "Apple, Banana, Kiwi";
let part = str.substr(7);
          `,
          "If the first parameter is negative, the position counts from the end of the string.",
        ];
        // DATA END

        data3.forEach((item) => {
          let template = `
            <p class="sound" onclick="speakText(this.innerHTML);"> ${item} </p>          
          `;
          if (item.slice(0, 4) == "\n>>h")
            template = `<h2 class="sound" onclick="speakText(this.innerHTML);">
            ${item.slice(4)}
          </h2>`;
          if (item.slice(0, 7) == "\n>>code")
            template = `<pre><code>${item.slice(7)}</code></pre>          
          `;
          article3.innerHTML += template;
        });
      </script>
    </article>

    <nav></nav>

    <!-- ***************************************** Article ***************************************** -->
    <article class="scene" id="scene">
      <div class="left">
        <img
          src="./src/img/teacher.png"
          alt="Dildo"
          style="max-width: 20rem; transition: 0.5s"
        />
      </div>
      <div class="right">
        <h2></h2>
        <div class="dialog"></div>
        <button
          id="next-btn"
          onclick="nextPortion(this)"
          type="button"
          class="next-btn btn btn-success btn-lg"
        >
          NEXT
        </button>

        <div class="centered">
          <button
            id="start-btn"
            onclick="runScene(this)"
            type="button"
            class="start-btn btn btn-success btn-lg"
          >
            START
          </button>
        </div>
      </div>
    </article>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <script src="./src/js/lib.js"></script>
    <script src="./src/data/data.js"></script>

    <script>
      let subChapterPointer = 0;
      let portionPointer = 0;
      let phrasePointer = 0;

      let data4;
      let doc;

      const UI = {};
      [
        ["scene", "#scene"],
        ["header", "#scene h2"],
        ["dialog", "#scene .dialog"],
        ["nav", "nav"],
        ["nextBtn", "#next-btn"],
        ["startBtn", "#start-btn"],
      ].forEach((item) => (UI[item[0]] = document.querySelector(item[1])));

      log(UI);

      async function init() {
        try {
          const answer = await fetch("./src/data/data.yaml");
          const yaml = await answer.text();
          // log(yaml);
          // yaml
          doc = jsyaml.load(yaml);
          // log(doc);
          data4 = doc[0];
          log("Loaded data");
          renderNavigation();
        } catch (e) {
          console.error(e);
        }
      }
      init();

      function renderNavigation() {
        UI.nav.innerHTML = "";
        doc.forEach((subChapter, i) => {
          UI.nav.innerHTML += `<button type="button" onclick="loadSubChapter(${i})" class="sub-chapter btn btn-outline-secondary btn-lg ${
            i == subChapterPointer ? "active" : ""
          }">${subChapter.header}</button>`;
        });
        renderHeader();
      }

      function loadSubChapter(i) {
        resetScene();
        subChapterPointer = i;
        data4 = doc[i];
        renderNavigation();
        renderHeader();
      }

      function renderHeader() {
        UI.header.innerHTML = `<h2 class="sound" onclick="speakText(this.innerHTML);">${data4.header.trim()}</h2>`;
      }

      async function runScene(btn) {
        if (!data4) return;
        btn.style.display = "none";
        UI.nextBtn.style.display = "none";
        playSound("./src/sounds/yamete_kudasai.mp3");
        await pause(2000);
        runPortion();
      }

      function resetScene() {
        portionPointer = 0;
        phrasePointer = 0;
        UI.dialog.innerHTML = "";
        UI.nextBtn.style.display = "none";
        UI.startBtn.style.display = "block";
      }

      function nextPortion(btn) {
        btn.style.display = "none";
        phrasePointer = 0;
        portionPointer++;
        runPortion();
      }

      async function addExampleToScene(content) {
        const pre = document.createElement("pre");
        const code = document.createElement("code");
        pre.classList.add("scene-example");
        code.innerHTML = content;
        code.classList.add("language-javascript");
        // hljs language-rust language-javascript
        pre.appendChild(code);
        UI.dialog.appendChild(pre);
        // await pause(2000);
        hljs.highlightAll();
      }

      function addPhraseToScene(content) {
        const node = document.createElement("pre");
        node.onclick = () => speakText(node.innerHTML);
        node.classList.add("scene-phrase");
        node.innerHTML = content;
        UI.dialog.appendChild(node);
      }

      async function runPortion() {
        const example = data4.portions[portionPointer].example;
        if (example) addExampleToScene(example);
        scrollDown();
        await pause(2000);
        phraseCicle();
      }

      // recursion repetition of all text phrases
      async function phraseCicle() {
        addPhraseToScene(data4.portions[portionPointer].text[phrasePointer]);
        scrollDown();
        // await pause(1000);
        // scrollDown();
        //
        speakText2(data4.portions[portionPointer].text[phrasePointer], () => {
          setTimeout(() => {
            phrasePointer++;
            if (
              phrasePointer <=
              data4.portions[portionPointer].text.length - 1
            ) {
              phraseCicle();
            } else {
              log("The end of phrases has been reached");
              if (portionPointer < data4.portions.length - 1) {
                UI.nextBtn.style.display = "block";
                scrollDown();
              }
            }
          }, 1000);
        });
      }
    </script>

    <script src="./src/js/highlight.js"></script>

    <script>
      speakText("");

      setTimeout(() => {
        scrollDown();
      }, 500);
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
